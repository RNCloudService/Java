# 三十七.【Redux创建】订单 Slice

对文件的几个模块做修改。

## interface

首先是state接口，

- 改名为OrderState。
- state数据，改名为当前订单 current Order ，数据类型使用 any 

```javascript
interface OrderState {
	loading: boolean;
	error: string | null;
	currentOrder: any,
}
```

## initialState

据新的state接口来修改initialState，创建初始化数据。

```javascript
const initialState: OrderState = {
	loading: false,
	error: null,
	currentOrder: null,
};
```

## thunk action： 获得的用户的购物车

- 修改一下它的命名空间，应该是order下的/placeOrder。

- action函数，需要传入两个参数，这两个参数使用对象包裹一下，parameter。第一个参数，jwt，第二个参数orderId，string类型

- 对于订单支付业务，ajax请求应该使用post请求，修改一下。

- post请求的url也得改一下，在url的order后面，跟着的是订单的id，
  http://123.56.149.216:8080/api/orders/${parameter.orderId}/placeOrder

- 订单支付 api 请求不需要请求主体，post请求的第二个参数使用 null

- Post 请求的第三个参数要填入请求的header以及jwt数据。这个商品id以及jwt都是函数的第一个参数传入进来的。

- return的数据就是订单支付的处理数据

  ```javascript
  export const placeOrder = createAsyncThunk(
  	"order/placeOrder",
  	async (parameter: { jwt: string; orderId: string }, thunkAPI) => {
  		const { data } = await axios.post(
  			`http://123.56.149.216:8080/api/orders/${parameter.orderId}/placeOrder`,
  			null,
  			{
  				headers: {
  					Authorization: `bearer ${parameters.jwt}`,
  				},
  			}
  		);
  		return data;
  	}
  );
  ```

## store.ts

把reducer输入store。

文件引入OrderSlice。在rootReducer 中，把order slice的reducer放进去

```javascript
import { orderSlice } from "./order/slice";

const rootReducer = combineReducers({
	language: languageReducer,
	recommendProducts: recommendProductsReducer,
	productDetail: productDetailSlice.reducer,
	productSearch: productSearchSlice.reducer,
	user: userSlice.reducer,
	shoppingCart: ShoppingCartSlice.reducer,
	order: orderSlice.reducer
});
```