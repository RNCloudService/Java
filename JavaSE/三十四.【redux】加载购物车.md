# 三十四.【redux】加载购物车

## app启动，加载购物车

加入三个引用，

- 从react中引入副作用 useEffect hook；
- 引入 react-redux 的 useDispatch hook函数；
- 引入 shoppingCart/slice 中的 getShoppingCart action。

```javascript
import React, { useEffect } from "react";
import { useDispatch } from "react-redux";
import { getShoppingCart } from "./redux/shoppingCart/slice";
```

通过useDispatch hook获得dispatch 函数,使用useEffect 来通过副作用向store 发送getShoppingCart action 信息

```javascript
const dispatch = useDispatch();

useEffect(() => {
	if (jwt) {
		dispatch(getShoppingCart(jwt));
	}
}, [jwt]);
```

## 顶部导航

使用useSelector获得shoppingCartItems 的数据，使用useSelector获得shoppingCart的Loading状态

```javascript
 const shoppingCartItems = useSelector((s) => s.shoppingCart.items);
 const shoppingCartLoading = useSelector((s) => s.shoppingCart.loading);
```

shoppingCart 按钮，

- 给button加上一个loading的状态，loading的状态跟随shoppingCartLoading ；

- 给button的标题上个小括号字符串，括号内填写shoppingCartItems 的数量， shoppingCartItems.length。

  ```javascript
  <Button
  	loading={shoppingCartLoading}
  	onClick={() => history.push("/shoppingCart")}
  	>
  	{t("header.shoppingCart")}({shoppingCartItems.length})
  	</Button>
  ```

## 产品详情，添加购物车

处理如何向购物车添加商品

- 从antdesign中引入Button ，会用这个组件制作添加购物车按钮。

- 从ant-design/icons引入ShoppingCartOutlined ，作为“添加购物车按钮”的icon。

- 从shoppingCart/slice中引入添加购物车 addShoppingCartItem action

  ```javascript
  import { Spin, Row, Col, Divider, Typography, Anchor, Menu, Button } from "antd";
  import { ShoppingCartOutlined } from "@ant-design/icons";
  import { addShoppingCartItem } from "../../redux/shoppingCart/slice";
  ```

连接store获得的数据

- 第一个， jwt ，

- 第二个，shoppingCart的Loading 的状态

  ```javascript
  const jwt = useSelector((s) => s.user.token) as string;
  const shoppingCartLoading = useSelector((s) => s.shoppingCart.loading);
  ```

在RangePicker上边加入添加购物车button

- marginTop: 50, marginBottom: 30, display: “block”

- type=“primary”

- 红色 danger

- loading={shoppingCartLoading}

- 加上icon，

- 添加button的名称“加入购物车”

  处理按钮的onClick事件

  ```javascript
  <Button
  	style={{ marginTop: 50, marginBottom: 30, display: "block" }}
  	type="primary"
  	danger
  	loading={shoppingCartLoading}
  	onClick={() =>
  		dispatch(
  			addShoppingCartItem({ jwt, touristRouteId: product.id })
  		)
  	}
  	
  >
  	<ShoppingCartOutlined />
  	加入购物车
  </Button>
  ```